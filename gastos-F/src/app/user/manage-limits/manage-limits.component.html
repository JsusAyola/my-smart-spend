<div class="limits-container">
    <h2>ðŸ“Š Gestionar LÃ­mites</h2>
  
    <form [formGroup]="limitsForm" (ngSubmit)="saveLimits()">
  
      <!-- Card global -->
      <div class="card global-card">
        <h3>LÃ­mite Mensual Global</h3>
        <select formControlName="global" class="limit-select">
          <option [ngValue]="null" disabled>Selecciona un monto</option>
          <option *ngFor="let opt of presetOptions" [ngValue]="opt">
            {{ opt | currency:'COP':'symbol':'1.0-0' }}
          </option>
        </select>
        <button type="submit" class="btn-save" [disabled]="!limitsForm.value.global">
          Guardar
        </button>
  
        <div *ngIf="limitsForm.value.global" class="progress-info">
          Has gastado {{ totalThisMonth | currency:'COP' }} /
          {{ limitsForm.value.global | currency:'COP' }}
          ({{ percent(totalThisMonth, limitsForm.value.global) }}%)
        </div>
        <div class="progress-bar">
          <div class="fill"
               [style.width.%]="percent(totalThisMonth, limitsForm.value.global)"
               [ngClass]="pctClass(percent(totalThisMonth, limitsForm.value.global))">
          </div>
        </div>
      </div>
  
      <!-- Grid de categorÃ­as -->
      <div class="grid-cats" formGroupName="byCategory">
        <div *ngFor="let cat of categories" class="card cat-card">
          <h4>{{ cat }}</h4>
          <select [formControlName]="cat" class="limit-select">
            <option [ngValue]="null" disabled>Sin lÃ­mite</option>
            <option *ngFor="let opt of presetOptions" [ngValue]="opt">
              {{ opt | currency:'COP':'symbol':'1.0-0' }}
            </option>
          </select>
  
          <ng-container *ngIf="limitsForm.value.byCategory[cat]">
            <div class="progress-bar small">
              <div class="fill"
                   [style.width.%]="percent(totalsByCat[cat]||0, limitsForm.value.byCategory[cat])"
                   [ngClass]="pctClass(percent(totalsByCat[cat]||0, limitsForm.value.byCategory[cat]))">
              </div>
            </div>
            <div class="progress-info small">
              {{ (totalsByCat[cat]||0) | currency:'COP' }} /
              {{ limitsForm.value.byCategory[cat] | currency:'COP' }}
              ({{ percent(totalsByCat[cat]||0, limitsForm.value.byCategory[cat]) }}%)
            </div>
          </ng-container>
        </div>
      </div>
  
    </form>
  </div>
  